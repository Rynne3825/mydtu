<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>mydtu - Contact</title>
    <style>
      body {
        font-family: system-ui, Arial, sans-serif;
        max-width: 720px;
        margin: 48px auto;
        padding: 0 16px;
      }
      label {
        display: block;
        margin: 14px 0 6px;
        font-weight: 600;
      }
      input,
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 10px;
        font-size: 16px;
      }
      button {
        margin-top: 14px;
        padding: 10px 14px;
        border: 0;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .status {
        margin-top: 12px;
        padding: 10px;
        border-radius: 10px;
        display: none;
      }
      .status.ok {
        display: block;
        border: 1px solid #c7f2c7;
        background: #effcef;
      }
      .status.err {
        display: block;
        border: 1px solid #f2c7c7;
        background: #fff1f1;
      }
      .muted {
        color: #666;
        font-size: 14px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Contact form</h1>
    <p class="muted">Gửi thử một tin nhắn để kiểm tra lưu dữ liệu vào D1.</p>

    <form id="contactForm">
      <div class="row">
        <div>
          <label for="name">Tên</label>
          <input id="name" name="name" autocomplete="name" required />
        </div>
        <div>
          <label for="email">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            autocomplete="email"
            required
          />
        </div>
      </div>

      <label for="message">Nội dung</label>
      <textarea id="message" name="message" rows="6" required></textarea>

      <button id="submitBtn" type="submit">Gửi</button>
      <div id="status" class="status"></div>
    </form>

    <script>
      const form = document.getElementById("contactForm");
      const btn = document.getElementById("submitBtn");
      const statusEl = document.getElementById("status");

      function setStatus(type, text) {
        statusEl.className = "status " + (type === "ok" ? "ok" : "err");
        statusEl.textContent = text;
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        statusEl.style.display = "none";

        const payload = {
          name: form.name.value.trim(),
          email: form.email.value.trim(),
          message: form.message.value.trim(),
        };

        if (!payload.name || !payload.email || !payload.message) {
          setStatus("err", "Vui lòng nhập đầy đủ thông tin.");
          return;
        }

        btn.disabled = true;
        btn.textContent = "Đang gửi...";

        try {
          const res = await fetch("/api/contact", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok || !data.success) {
            throw new Error(data.error || "Gửi thất bại");
          }

          setStatus("ok", "Gửi thành công. Dữ liệu đã được lưu vào D1.");
          form.reset();
        } catch (err) {
          setStatus("err", "Lỗi: " + err.message);
        } finally {
          btn.disabled = false;
          btn.textContent = "Gửi";
        }
      });
    </script>
  </body>
</html>
